<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <title>Win-Overlay-Artji ‚Äî Control Panel</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@600;700&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --bg:#0c1016;
      --ink:#f5f7fb;
      --muted:#aab1b8;
      --line:rgba(255,255,255,.12);
      --glass:rgba(255,255,255,.06);
      --ok:#22c55e; --bad:#ef4444;
      --rad:14px; --gap:10px; --pad:12px;
      --colw: 340px;      /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
      --maxw: 1120px;     /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏£‡∏ß‡∏° */
      --tileH: auto;      /* ‚¨ÖÔ∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å (‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤ WIN ‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥) */
    }
    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0; font-family:'Kanit',sans-serif; color:var(--ink);
      background:
        radial-gradient(900px 480px at 10% -20%, rgba(110,231,249,.18), transparent 60%),
        radial-gradient(900px 480px at 110% 120%, rgba(192,132,252,.15), transparent 60%),
        linear-gradient(120deg, #0b0f14, #0f1218 40%, #0b0f14);
      padding:14px 16px;
      overflow-y:auto;
    }
    

    .brand{
      display:flex; align-items:center; gap:12px;
      border:1px solid var(--line); background:var(--glass);
      padding:10px 12px; border-radius:var(--rad);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 36px rgba(0,0,0,.28);
      max-width: var(--maxw); margin: 0 auto var(--gap) auto;
    }
    .logo{ width:48px; height:48px; border-radius:50%; overflow:hidden; flex:0 0 48px;
      border:1px solid rgba(255,255,255,.28);
      box-shadow:0 0 0 2px rgba(255,255,255,.06) inset, 0 8px 26px rgba(0,0,0,.28);
    }
    .logo img{ width:100%; height:100%; object-fit:cover; display:block }
    .title{ display:flex; flex-direction:column; }
    .name{ font-size:18px } .sub{ font-size:11px; color:var(--muted) }
    .badge{ margin-left:auto; font-size:11px; padding:5px 9px; border-radius:999px;
      background:linear-gradient(135deg, rgba(110,231,249,.22), rgba(192,132,252,.22));
      border:1px solid var(--line);
    }

    .grid{
      max-width: var(--maxw); margin:0 auto;
      display:grid; gap:var(--gap);
      grid-template-columns: repeat(3, 1fr); /* 3 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏ô‡πà‡∏ô ‡πÜ */
      align-items:start;
    }

    /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏∏‡∏Å‡πÉ‡∏ö‡∏à‡∏∞ ‚Äú‡∏™‡∏π‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‚Äù ‡∏î‡πâ‡∏ß‡∏¢ min-height ‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å --tileH */
    .tile{
      position:relative;
      background:var(--glass); border:1px solid var(--line);
      border-radius:var(--rad);
      padding:var(--pad);
      display:flex; flex-direction:column; gap:8px;
      min-height: var(--tileH);     /* ‚¨ÖÔ∏è ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏´‡∏•‡∏∞‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç */
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 36px rgba(0,0,0,.28);
    }
    .tile h3{ margin:0; font-size:15px; display:flex; gap:8px; align-items:center }
    .tile .hint{ font-size:12px; color:var(--muted) }

    label{ font-size:12px; color:var(--muted); display:block; margin-bottom:4px }
    input[type="number"], input[type="color"], input[type="range"]{
      width:100%; padding:8px 10px; font:inherit; color:var(--ink);
      border-radius:10px; border:1px solid var(--line); background:rgba(255,255,255,0.05); outline:none;
    }
    .row{ display:grid; gap:8px; grid-template-columns: 1fr 1fr }

    .btn{
      padding:8px 10px; border-radius:10px; border:1px solid var(--line);
      background: rgba(255,255,255,.06); color:var(--ink); cursor:pointer;
      transition: transform .06s ease, background .2s;
    }
    .btn:hover{ background: rgba(255,255,255,.10) }
    .btn:active{ transform: translateY(1px) }
    .btn.primary{ border-color: rgba(110,231,249,.45) }
    .btn.good{ border-color: rgba(34,197,94,.45) }
    .btn.bad{  border-color: rgba(239,68,68,.45) }
    .btn.copy{ border-color: rgba(192,132,252,.45) }

    .switch{ position:relative; width:48px; height:28px; border-radius:999px; background: rgba(255,255,255,.1); border:1px solid var(--line); cursor:pointer; display:inline-block }
    .switch input{ display:none }
    .knob{ position:absolute; top:2px; left:2px; width:24px; height:24px; border-radius:50%; background:#fff; transition: transform .18s }
    .switch input:checked + .knob{ transform: translateX(20px) }

    .iframe-wrap{
      height: 200px;  /* ‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‚Äî ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏µ‡∏ö‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏£‡∏ß‡∏° */
      border-radius:12px; overflow:hidden; border:1px dashed var(--line);
      background: rgba(0,0,0,.22);
      flex: 1;       /* ‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏±‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ */
    }
    .iframe-wrap iframe{ width:100%; height:100%; border:0; display:block; background:transparent }

    .status{ font-size:12px; color:var(--muted) }
    .ok{ color:var(--ok) } .err{ color:var(--bad) }

    .btn[disabled]{ opacity:.45; cursor:not-allowed }




    .license{
      grid-column: 1 / -1;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(239,68,68,.12), rgba(239,68,68,.06));
      color:#ffd4d4; padding:10px 12px; border-radius:var(--rad);
      display:flex; gap:8px; align-items:flex-start;
      min-height: auto; /* ‡∏Å‡∏•‡πà‡∏≠‡∏á License ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô (‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏µ‡πâ‡∏¢‡πÑ‡∏î‡πâ) */
    }


    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      :root{ --maxw: 100%; }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <section class="brand">
    <div class="logo">
      <img src="https://media.discordapp.net/attachments/1277323066543968488/1279813629293760663/09.jpg?ex=68e3d553&is=68e283d3&hm=a1353f978ff1df8fd9a50f55fb746d1627c54cf4c5630e44923c8f0c9866cc71&=&format=webp&width=960&height=960" alt="logo"/>
    </div>
    <div class="title">
      <div class="name">Win-Overlay-Artji</div>
      <div class="sub">Compact Grid ‚Ä¢ Overlay Manager</div>
    </div>
    <span class="badge">v1</span>
  </section>

  <section class="grid">
    <!-- üéØ ‡πÉ‡∏ä‡πâ id="tile-win" ‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏ï‡∏±‡∏ß‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‚Äù -->
    <div class="tile" id="tile-win">
      <h3>üéØ ‡∏Ñ‡πà‡∏≤ WIN</h3>
      <div>
        <label>‡∏ß‡∏¥‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡πÑ‡∏î‡πâ)</label>
        <input id="currentInput" type="number" step="1"/>
      </div>
      <div>
        <label>Max Win</label>
        <input id="maxWinInput" type="number" min="1" step="1"/>
      </div>
      <div style="margin-top:auto; display:flex; gap:8px; align-items:center">
        <button id="saveBtn" class="btn primary">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <span id="status" class="status"></span>
      </div>
    </div>

    <div class="tile">
      <h3>üß© ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏•‡πà‡∏≠‡∏á</h3>
      <div class="row">
        <div>
          <label>Stroke Size (px)</label>
          <input id="strokeSize" type="range" min="0" max="12" step="1"/>
        </div>
        <div>
          <label>Stroke Color</label>
          <input id="strokeColor" type="color"/>
        </div>
      </div>
      <div style="display:flex; align-items:center; gap:10px; margin-top:6px">
        <label class="switch"><input id="bgSwitch" type="checkbox"><span class="knob"></span></label>
        <span class="status">‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á (‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î)</span>
      </div>
    </div>

    <div class="tile">
      <h3>üïπÔ∏è ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÅ‡∏ö‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</h3>
      <div>
        <label>‡∏Ç‡∏±‡πâ‡∏ô (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô)</label>
        <input id="stepInput" type="number" value="1" step="1"/>
      </div>
      <div style="display:flex; gap:8px">
        <button id="btnMinus" class="btn bad">‚Äì ‡∏•‡∏î WIN</button>
        <button id="btnPlus"  class="btn good">+ ‡πÄ‡∏û‡∏¥‡πà‡∏° WIN</button>
      </div>
    </div>

    <div class="tile">
      <h3>üîó TikFinity Webhook</h3>
      <div>
        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (step)</label>
        <input id="webhookStep" type="number" value="5" min="1" step="1"/>
      </div>
      <div style="display:flex; gap:8px">
        <button id="copyMinusWebhook" class="btn copy">üìã ‡∏•‡∏¥‡∏á‡∏Å‡πå ‚Äì ‡∏•‡∏î</button>
        <button id="copyPlusWebhook"  class="btn copy">üìã ‡∏•‡∏¥‡∏á‡∏Å‡πå + ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
      </div>
      <div id="webhookPreview" class="status" style="white-space:pre-wrap; margin-top:4px"></div>
    </div>

    <div class="tile">
      <h3>üëÄ ‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß Overlay</h3>
      <div class="iframe-wrap">
        <iframe id="previewFrame" src="/overlay.html?mute=1" allow="autoplay"></iframe>
      </div>
      <div style="display:flex; gap:8px; align-items:center; margin-top:6px">
        <button class="btn" id="copyBtn">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL Overlay</button>
        <span class="status" id="copyStatus"></span>
      </div>
    </div>

    <!-- ‡∏ö‡∏•‡πá‡∏≠‡∏Å: Presets & Lock -->
    <div class="tile" id="tile-presets">
      <h3>‚ö° Presets & Lock</h3>

      <div class="row">
        <div>
          <label>‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ A</label>
          <input id="presetA" type="number" value="5" step="1"/>
        </div>
        <div>
          <label>‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ B</label>
          <input id="presetB" type="number" value="10" step="1"/>
        </div>
      </div>

      <div style="display:flex; flex-wrap:wrap; gap:8px; margin-top:6px">
        <button class="btn" id="btnM5">‚Äì5</button>
        <button class="btn" id="btnP5">+5</button>
        <button class="btn" id="btnM10">‚Äì10</button>
        <button class="btn" id="btnP10">+10</button>
        <button class="btn" id="btnAminus">‚ÄìA</button>
        <button class="btn" id="btnAplus">+A</button>
        <button class="btn" id="btnBminus">‚ÄìB</button>
        <button class="btn" id="btnBplus">+B</button>
      </div>

      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px">
        <button class="btn bad"    id="btnReset">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï = 0</button>
        <button class="btn good"   id="btnSetMax">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô Max</button>
        <button class="btn copy"   id="btnCopyReset">üìã ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
        <button class="btn copy"   id="btnCopySetMax">üìã ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô Max</button>
      </div>

      <div style="display:flex; align-items:center; gap:10px; margin-top:10px">
        <label class="switch">
          <input id="lockToggle" type="checkbox"><span class="knob"></span>
        </label>
        <span class="status">‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏û‡∏•‡∏≤‡∏î)</span>
      </div>
    </div>



    <div class="license tile">
      <div>üîí</div>
      <div>
        <b>‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</b>
        ‡∏ã‡∏≠‡∏ü‡∏ï‡πå‡πÅ‡∏ß‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ <b>‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î Critical Agency ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</b> ‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏à‡∏Å‡∏à‡πà‡∏≤‡∏¢ ‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢
        ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏≠‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏´‡πâ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏≤‡∏¢‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏≠‡∏±‡∏Å‡∏©‡∏£
      </div>
    </div>
  </section>

  <script>
  const TOKEN = 'artjiraphatjtt';
  const APP   = 'winoverlay';
  const $ = id => document.getElementById(id);

  const currentEl = $('currentInput');
  const maxEl     = $('maxWinInput');
  const bgSwitch  = $('bgSwitch');
  const strokeSizeEl  = $('strokeSize');
  const strokeColorEl = $('strokeColor');
  const statusEl  = $('status');
  const saveBtn   = $('saveBtn');

  const stepEl    = $('stepInput');
  const btnPlus   = $('btnPlus');
  const btnMinus  = $('btnMinus');

  const webhookStep = $('webhookStep');
  const copyMinusWebhook = $('copyMinusWebhook');
  const copyPlusWebhook  = $('copyPlusWebhook');
  const webhookPreview   = $('webhookPreview');

  const copyBtn   = $('copyBtn');
  const copyStatusEl = $('copyStatus');

  // ==== Presets & Lock (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ id ‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡πÉ‡∏ô HTML ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô) ====
  const presetA   = $('presetA');
  const presetB   = $('presetB');

  const btnM5     = $('btnM5');
  const btnP5     = $('btnP5');
  const btnM10    = $('btnM10');
  const btnP10    = $('btnP10');
  const btnAminus = $('btnAminus');
  const btnAplus  = $('btnAplus');
  const btnBminus = $('btnBminus');
  const btnBplus  = $('btnBplus');

  const btnReset      = $('btnReset');
  const btnSetMax     = $('btnSetMax');
  const btnCopyReset  = $('btnCopyReset');
  const btnCopySetMax = $('btnCopySetMax');

  const lockToggle = $('lockToggle');

  // ‡∏£‡∏ß‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Å (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ element ‡πÉ‡∏î ‡∏Å‡πá filter ‡∏ó‡∏¥‡πâ‡∏á)
  const lockTargets = [
    btnMinus, btnPlus, saveBtn,
    btnM5, btnP5, btnM10, btnP10,
    btnAminus, btnAplus, btnBminus, btnBplus,
    btnReset, btnSetMax
  ].filter(Boolean);

  function setLocked(on){
    lockTargets.forEach(b => b.disabled = !!on);
  }
  lockToggle?.addEventListener('change', ()=> setLocked(lockToggle.checked));

  // --- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏™‡∏π‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö üéØ ‡∏Ñ‡πà‡∏≤ WIN ---
  function equalizeTileHeights(){
    const winTile = document.getElementById('tile-win');
    if (!winTile) return;
    const h = winTile.getBoundingClientRect().height;
    document.documentElement.style.setProperty('--tileH', Math.ceil(h) + 'px');
  }
  window.addEventListener('load', equalizeTileHeights);
  window.addEventListener('resize', ()=> { requestAnimationFrame(equalizeTileHeights); });

  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
  (async function init(){
    try {
      const cfg = await (await fetch('/api/config', { cache: 'no-store' })).json();
      syncToForm(cfg);
      setStatus('üü¢ ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß', true);
      renderWebhookPreview();
    } catch {
      setStatus('‚ùå ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', false);
    } finally {
      equalizeTileHeights();
    }
  })();

  // ‡∏ü‡∏±‡∏á WS ‡πÄ‡∏û‡∏∑‡πà‡∏≠ sync ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏ö‡∏ö‡∏™‡∏î
  (function wsConfig(){
    const host = location.hostname || 'localhost';
    const ws = new WebSocket(`ws://${host}:8080`);
    ws.onmessage = (e)=>{
      try{
        const obj = JSON.parse(e.data);
        if (obj?.type === 'state') {
          syncToForm(obj.data || {});
          equalizeTileHeights();
        }
      }catch{}
    };
    ws.onclose = ()=> setTimeout(wsConfig, 1500);
  })();

  function syncToForm(s){
    if (Number.isFinite(s.current)) currentEl.value = s.current;
    if (Number.isFinite(s.maxWin))  maxEl.value     = s.maxWin;
    if (typeof s.showBg === 'boolean') bgSwitch.checked = !!s.showBg;
    if (Number.isFinite(s.strokeWidth)) strokeSizeEl.value = s.strokeWidth;
    if (s.strokeColor) strokeColorEl.value = s.strokeColor;
  }

  function setStatus(msg, ok){
    statusEl.textContent = msg;
    statusEl.className = 'status ' + (ok ? 'ok' : 'err');
    if (ok) setTimeout(()=>{ statusEl.textContent=''; }, 1200);
  }

  // ‡∏õ‡∏∏‡πà‡∏° "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å"
  saveBtn?.addEventListener('click', async ()=>{
    const body = {
      current: Number.parseInt(currentEl.value,10),
      maxWin:  Math.max(1, Number.parseInt(maxEl.value,10)),
      showBg: bgSwitch.checked,
      strokeWidth: Number.parseInt(strokeSizeEl.value,10),
      strokeColor: strokeColorEl.value
    };
    try{
      const res = await fetch('/api/config', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify(body)
      });
      setStatus(res.ok ? '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢' : '‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', res.ok);
    }catch{
      setStatus('‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', false);
    } finally {
      equalizeTileHeights();
    }
  });

  // ‡∏õ‡∏∏‡πà‡∏° +/- ‡∏¢‡∏¥‡∏á webhook ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
  btnPlus?.addEventListener('click', ()=> sendWebhook('win_plus', stepEl));
  btnMinus?.addEventListener('click', ()=> sendWebhook('win_minus', stepEl));

  async function sendWebhook(action, stepInput){
    const n = Math.max(1, Number.parseInt(stepInput.value,10) || 1);
    const payload = `${TOKEN}:${APP}:${action}:${n}`;
    const url = `/hook/${encodeURIComponent(payload)}`;
    try{
      const res = await fetch(url);
      if (!res.ok) throw new Error('HTTP '+res.status);
      setStatus(`‚úÖ ${action==='win_plus'?'‡πÄ‡∏û‡∏¥‡πà‡∏°':'‡∏•‡∏î'} ${n}`, true);
    }catch(e){
      setStatus('‚ùå ‡∏¢‡∏¥‡∏á webhook ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', false);
    }
  }

  // Webhook (copy ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö TikFinity)
  function buildWebhook(action){
    const base = location.origin.replace(/\/+$/,'');
    const n = Math.max(1, Number.parseInt(webhookStep.value,10) || 1);
    const payload = `${TOKEN}:${APP}:${action}:${n}`;
    return `${base}/hook/${encodeURIComponent(payload)}`;
  }
  function renderWebhookPreview(){
    if (!webhookPreview) return;
    webhookPreview.textContent =
      `‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå:
‚Äì ${buildWebhook('win_minus')}
+ ${buildWebhook('win_plus')}`;
  }
  async function copyText(s){
    await navigator.clipboard.writeText(s);
    if (webhookPreview){
      webhookPreview.textContent = '‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: ' + s;
      setTimeout(renderWebhookPreview, 1200);
    }
  }
  webhookStep?.addEventListener('input', renderWebhookPreview);
  copyMinusWebhook?.addEventListener('click', ()=> copyText(buildWebhook('win_minus')));
  copyPlusWebhook?.addEventListener('click', ()=> copyText(buildWebhook('win_plus')));

  // ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL overlay
  copyBtn?.addEventListener('click', async ()=>{
    const url = location.origin + '/overlay.html';
    await navigator.clipboard.writeText(url);
    if (copyStatusEl){
      copyStatusEl.textContent = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: '+url;
      setTimeout(()=> copyStatusEl.textContent = '', 1200);
    }
  });

  // ====== Presets & Lock: actions ======
  async function fireStep(delta){
    if (lockToggle?.checked) return;
    const action = delta >= 0 ? 'win_plus' : 'win_minus';
    const n = Math.abs(delta) || 1;
    const payload = `${TOKEN}:${APP}:${action}:${n}`;
    const url = `/hook/${encodeURIComponent(payload)}`;
    try{
      const res = await fetch(url);
      if (!res.ok) throw 0;
      setStatus(`‚úÖ ${delta>=0?'+':'‚àí'}${n}`, true);
    }catch{ setStatus('‚ùå ‡∏¢‡∏¥‡∏á webhook ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', false); }
  }

  async function fireSetCurrent(n){
    if (lockToggle?.checked) return;
    const payload = `${TOKEN}:${APP}:set_current:${n}`;
    try{
      const res = await fetch(`/hook/${encodeURIComponent(payload)}`);
      if (!res.ok) throw 0;
      setStatus(`‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ WIN = ${n}`, true);
    }catch{ setStatus('‚ùå ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', false); }
  }

  async function fireSetMax(){
    if (lockToggle?.checked) return;
    try{
      const cfg = await (await fetch('/api/config', {cache:'no-store'})).json();
      const n = Number.isFinite(cfg.maxWin) ? cfg.maxWin : 0;
      await fireSetCurrent(n);
    }catch{ setStatus('‚ùå ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤ Max ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ', false); }
  }

  // ‡∏ú‡∏π‡∏Å‡∏õ‡∏∏‡πà‡∏° (‡∏°‡∏µ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ element ‡∏à‡∏£‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô)
  btnM5    ?.addEventListener('click', ()=> fireStep(-5));
  btnP5    ?.addEventListener('click', ()=> fireStep(+5));
  btnM10   ?.addEventListener('click', ()=> fireStep(-10));
  btnP10   ?.addEventListener('click', ()=> fireStep(+10));
  btnAminus?.addEventListener('click', ()=> fireStep(- Math.max(1, parseInt(presetA?.value||'1',10))));
  btnAplus ?.addEventListener('click', ()=> fireStep(+ Math.max(1, parseInt(presetA?.value||'1',10))));
  btnBminus?.addEventListener('click', ()=> fireStep(- Math.max(1, parseInt(presetB?.value||'1',10))));
  btnBplus ?.addEventListener('click', ()=> fireStep(+ Math.max(1, parseInt(presetB?.value||'1',10))));
  btnReset ?.addEventListener('click', ()=> fireSetCurrent(0));
  btnSetMax?.addEventListener('click', fireSetMax);

  // ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå reset / set max
  function buildSetCurrentLink(n){
    const base = location.origin.replace(/\/+$/,'');
    const payload = `${TOKEN}:${APP}:set_current:${n}`;
    return `${base}/hook/${encodeURIComponent(payload)}`;
  }
  btnCopyReset ?.addEventListener('click', async ()=>{
    const url = buildSetCurrentLink(0);
    await navigator.clipboard.writeText(url);
    setStatus('‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏•‡πâ‡∏ß', true);
  });
  btnCopySetMax?.addEventListener('click', async ()=>{
    try{
      const cfg = await (await fetch('/api/config', {cache:'no-store'})).json();
      const n = Number.isFinite(cfg.maxWin) ? cfg.maxWin : 0;
      const url = buildSetCurrentLink(n);
      await navigator.clipboard.writeText(url);
      setStatus('‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô Max ‡πÅ‡∏•‡πâ‡∏ß', true);
    }catch{
      setStatus('‚ùå ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô Max ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', false);
    }
  });
</script>

</body>
</html>
